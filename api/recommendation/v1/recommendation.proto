syntax = "proto3";

package recommendation.v1;

option go_package = "github.com/wyfcoding/ecommerce/go-api/recommendation/v1;v1";

// 推荐服务，利用图算法及 AI 引擎为用户提供个性化商品及关联商品推荐。
service RecommendationService {
  // 基础接口：获取通用的推荐商品列表。
  rpc GetRecommendedProducts(GetRecommendedProductsRequest) returns (GetRecommendedProductsResponse);

  // 内部调用：将商品及用户关系数据同步至图数据库索引。
  rpc IndexProductRelationship(IndexProductRelationshipRequest) returns (IndexProductRelationshipResponse);

  // 社交/关联推荐：基于图关系获取相关的推荐商品（如：买了又买）。
  rpc GetGraphRecommendedProducts(GetGraphRecommendedProductsRequest) returns (GetGraphRecommendedProductsResponse);

  // 高级接口：AI 驱动的实时深度个性化推荐流。
  rpc GetAdvancedRecommendedProducts(GetAdvancedRecommendedProductsRequest) returns (GetAdvancedRecommendedProductsResponse);
}

// 通用推荐请求。
message GetRecommendedProductsRequest {
  // 目标用户。
  string user_id = 1;
  // 期望召回数量。
  int32 count = 2;
}

// 推荐结果集合。
message GetRecommendedProductsResponse {
  // 商品摘要列表。
  repeated Product products = 1;
}

// 推荐商品摘要。
message Product {
  // 商品 ID。
  string id = 1;
  // 名称。
  string name = 2;
  // 卖点描述。
  string description = 3;
  // 当前售价。
  double price = 4;
  // 主图。
  string image_url = 5;
}

// 图关系索引请求。
message IndexProductRelationshipRequest {
  // 节点 A ID。
  string product_id_1 = 1;
  // 节点 B ID。
  string product_id_2 = 2;
  // 关系类别 (SIMILAR, BOUGHT_TOGETHER)。
  string type = 3;
  // 关联权重值。
  double weight = 4;
}

// 索引结果。
message IndexProductRelationshipResponse {}

// 图查询请求。
message GetGraphRecommendedProductsRequest {
  // 起始商品 ID。
  string product_id = 1;
  // 数量。
  int32 count = 2;
}

// 图查询结果。
message GetGraphRecommendedProductsResponse {
  // 商品列表。
  repeated Product products = 1;
}

// 深度个性化请求。
message GetAdvancedRecommendedProductsRequest {
  // 用户 ID。
  string user_id = 1;
  // 数量。
  int32 count = 2;
  // 实时环境特征（如：当前页面、会话 ID）。
  map<string, string> context_features = 3;
}

// 深度个性化响应。
message GetAdvancedRecommendedProductsResponse {
  // 商品列表。
  repeated Product products = 1;
  // 推荐理由（解释性文字）。
  string explanation = 2;
}
