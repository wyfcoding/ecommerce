syntax = "proto3";

package api.data_processing.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/goapi/data_processing/v1;v1";

// 数据处理服务，负责对摄取的原始数据进行清洗、转换及聚合。
service DataProcessing {
  // 提交一个异步数据处理任务。
  rpc ProcessData(ProcessDataRequest) returns (ProcessDataResponse);

  // 查询特定任务的执行状态及结果。
  rpc GetProcessingStatus(GetProcessingStatusRequest) returns (ProcessingStatusResponse);
}

// 数据处理请求。
message ProcessDataRequest {
  // 待处理数据 ID。
  string data_id = 1;
  // 任务类型 (CLEAN, AGGREGATE, EXPORT)。
  string processing_type = 2;
  // 任务参数键值对。
  map<string, string> processing_params = 3;
}

// 提交响应。
message ProcessDataResponse {
  // 任务唯一 ID。
  string processing_id = 1;
  // 初始状态。
  string status = 2;
}

// 状态查询请求。
message GetProcessingStatusRequest {
  // 任务 ID。
  string processing_id = 1;
}

// 任务状态详情。
message ProcessingStatusResponse {
  // 任务 ID。
  string processing_id = 1;
  // 状态 (RUNNING, SUCCESS, FAILED)。
  string status = 2;
  // 结果文件下载地址。
  optional string result_data_url = 3;
  // 任务启动时间。
  google.protobuf.Timestamp started_at = 4;
  // 任务完成时间。
  optional google.protobuf.Timestamp completed_at = 5;
}
