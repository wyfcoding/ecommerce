syntax = "proto3";

package api.risksecurity.v1;

import "google/protobuf/empty.proto";

option go_package = "github.com/wyfcoding/ecommerce/goapi/risksecurity/v1;risksecurityv1";

// 风控安全服务，负责用户行为风险评估、黑名单管理及异常操作监控。
service RiskSecurityService {
  // 评估当前操作的风险等级（如登录、支付）。
  rpc EvaluateRisk(EvaluateRiskRequest) returns (EvaluateRiskResponse);

  // 将特定标识（IP、用户 ID 等）加入黑名单。
  rpc AddToBlacklist(AddToBlacklistRequest) returns (google.protobuf.Empty);

  // 从黑名单中移除特定标识。
  rpc RemoveFromBlacklist(RemoveFromBlacklistRequest) returns (google.protobuf.Empty);

  // 记录用户关键行为，用于后续风险建模。
  rpc RecordUserBehavior(RecordUserBehaviorRequest) returns (google.protobuf.Empty);
}

// 风险分析详情。
message RiskAnalysisResult {
  // 用户 ID。
  uint64 user_id = 1;
  // 风险量化评分。
  int32 risk_score = 2;
  // 风险等级标识。
  int32 risk_level = 3;
  // 命中风险项的详情 (JSON)。
  string risk_items_json = 4;
}

// 风险评估请求。
message EvaluateRiskRequest {
  // 用户 ID。
  uint64 user_id = 1;
  // 来源 IP。
  string ip = 2;
  // 硬件设备 ID。
  string device_id = 3;
  // 涉及的交易金额。
  int64 amount = 4;
}

// 风险评估响应。
message EvaluateRiskResponse {
  // 详细分析结果。
  RiskAnalysisResult result = 1;
}

// 加入黑名单请求。
message AddToBlacklistRequest {
  // 名单类型 (IP, USER, DEVICE)。
  string type = 1;
  // 封禁对象的值。
  string value = 2;
  // 封禁原因说明。
  string reason = 3;
  // 自动解封时间（秒）。
  int64 duration_seconds = 4;
}

// 移除黑名单请求。
message RemoveFromBlacklistRequest {
  // 记录 ID。
  uint64 id = 1;
}

// 行为记录请求。
message RecordUserBehaviorRequest {
  // 用户 ID。
  uint64 user_id = 1;
  // 实时 IP。
  string ip = 2;
  // 设备环境 ID。
  string device_id = 3;
}
