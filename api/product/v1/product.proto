syntax = "proto3";

package api.product.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/wrappers.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/product/v1;v1";

// 商品服务，管理 SPU、SKU、分类、品牌及商品属性。
service Product {
  // --- 商品 (SPU) 接口 ---

  // 创建新商品主体。
  rpc CreateProduct(CreateProductRequest) returns (ProductInfo);

  // 查询商品详情（含所有 SKU、分类、品牌）。
  rpc GetProductByID(GetProductByIDRequest) returns (ProductInfo);

  // 更新商品主体核心属性。
  rpc UpdateProductInfo(UpdateProductInfoRequest) returns (ProductInfo);

  // 物理或逻辑删除商品及其 SKU。
  rpc DeleteProduct(DeleteProductRequest) returns (google.protobuf.Empty);

  // 列表查询并筛选商品。
  rpc ListProducts(ListProductsRequest) returns (ListProductsResponse);

  // --- SKU 接口 ---

  // 为商品批量挂载销售规格 (SKU)。
  rpc AddSKUsToProduct(AddSKUsToProductRequest) returns (AddSKUsToProductResponse);

  // 修改特定销售规格的价格或库存。
  rpc UpdateSKU(UpdateSKURequest) returns (SKU);

  // 移除商品的特定规格。
  rpc DeleteSKU(DeleteSKURequest) returns (google.protobuf.Empty);

  // 查询单条 SKU 的明细。
  rpc GetSKUByID(GetSKUByIDRequest) returns (SKU);

  // --- 分类接口 ---

  // 创建新的类目。
  rpc CreateCategory(CreateCategoryRequest) returns (Category);

  // 获取类目信息。
  rpc GetCategoryByID(GetCategoryByIDRequest) returns (Category);

  // 修改类目层级或名称。
  rpc UpdateCategory(UpdateCategoryRequest) returns (Category);

  // 移除类目节点。
  rpc DeleteCategory(DeleteCategoryRequest) returns (google.protobuf.Empty);

  // 检索类目树或列表。
  rpc ListCategories(ListCategoriesRequest) returns (ListCategoriesResponse);

  // --- 品牌接口 ---

  // 录入新品牌信息。
  rpc CreateBrand(CreateBrandRequest) returns (Brand);

  // 查询品牌详情。
  rpc GetBrandByID(GetBrandByIDRequest) returns (Brand);

  // 更新品牌元数据。
  rpc UpdateBrand(UpdateBrandRequest) returns (Brand);

  // 删除品牌记录。
  rpc DeleteBrand(DeleteBrandRequest) returns (google.protobuf.Empty);

  // 列出系统所有品牌。
  rpc ListBrands(ListBrandsRequest) returns (ListBrandsResponse);
}

// 商品生存状态。
enum ProductStatus {
  PRODUCT_STATUS_UNSPECIFIED = 0;
  DRAFT = 1; // 编辑中/待审核
  ACTIVE = 2; // 已上架销售
  INACTIVE = 3; // 已手动下架
  DISCONTINUED = 4; // 永久停产
  ARCHIVED = 5; // 已归档历史
}

// 商品主体 (Standard Product Unit)。
message ProductInfo {
  // 系统 ID。
  uint64 id = 1;
  // 标题。
  string name = 2;
  // 商品统一编码。
  string spu_no = 3;
  // 详情介绍 (HTML)。
  string description = 4;
  // 所属叶子分类。
  Category category = 5;
  // 关联品牌。
  Brand brand = 6;
  // 当前状态。
  ProductStatus status = 7;
  // 下属所有规格。
  repeated SKU skus = 8;
  // 静态属性（如产地、材质）。
  repeated ProductAttribute attributes = 9;
  // 主图链接。
  string main_image_url = 10;
  // 详情图集。
  repeated string gallery_image_urls = 11;
  // 搜索引擎优化信息。
  SeoInfo seo_info = 12;
  // 创建时间。
  google.protobuf.Timestamp created_at = 13;
  // 更新时间。
  google.protobuf.Timestamp updated_at = 14;
  // 运输重量 (kg)。
  google.protobuf.DoubleValue weight = 15;
}

// 销售规格 (Stock Keeping Unit)。
message SKU {
  // 系统 ID。
  uint64 id = 1;
  // 父商品 ID。
  uint64 product_id = 2;
  // 规格独立编码。
  string sku_no = 3;
  // 规格展示名。
  string name = 4;
  // 销售价（分）。
  int64 price = 5;
  // 总实物库存。
  int32 stock_quantity = 6;
  // 规格特定图片。
  string image_url = 7;
  // 规格组合值（如颜色：红，尺码：XL）。
  repeated SpecValue spec_values = 8;
  // 创建时间。
  google.protobuf.Timestamp created_at = 9;
  // 更新时间。
  google.protobuf.Timestamp updated_at = 10;
}

// 商品类目。
message Category {
  // 类目 ID。
  uint64 id = 1;
  // 类目名称。
  string name = 2;
  // 父类目 ID。
  uint64 parent_id = 3;
  // 树层级。
  int32 level = 4;
  // 图标。
  string icon_url = 5;
  // 同级显示顺序。
  int32 sort_order = 6;
}

// 品牌。
message Brand {
  // 品牌 ID。
  uint64 id = 1;
  // 品牌名。
  string name = 2;
  // Logo 链接。
  string logo_url = 3;
  // 品牌故事或介绍。
  string description = 4;
}

// 商品静态属性。
message ProductAttribute {
  // 属性名（如：颜色）。
  string key = 1;
  // 属性值（如：黑色）。
  string value = 2;
}

// 规格项。
message SpecValue {
  // 规格名。
  string key = 1;
  // 规格值。
  string value = 2;
}

// 检索优化。
message SeoInfo {
  // SEO 标题。
  string meta_title = 1;
  // SEO 描述。
  string meta_description = 2;
  // 关键字。
  string meta_keywords = 3;
  // 友好 URL 片段。
  string url_slug = 4;
}

// 商品创建请求。
message CreateProductRequest {
  // 标题。
  string name = 1;
  // 描述。
  string description = 2;
  // 分类 ID。
  uint64 category_id = 3;
  // 品牌 ID。
  uint64 brand_id = 4;
  // 初始状态。
  ProductStatus status = 5;
  // 静态属性。
  repeated ProductAttribute attributes = 6;
  // 主图。
  string main_image_url = 7;
  // 图集。
  repeated string gallery_image_urls = 8;
  // SEO 详情。
  SeoInfo seo_info = 9;
  // 重量。
  google.protobuf.DoubleValue weight = 10;
}

// ID 查询请求。
message GetProductByIDRequest {
  // 系统 ID。
  uint64 id = 1;
}

// 更新请求。
message UpdateProductInfoRequest {
  // 目标 ID。
  uint64 id = 1;
  // 待更新标题。
  google.protobuf.StringValue name = 2;
  // 待更新描述。
  google.protobuf.StringValue description = 3;
  // 目标分类。
  google.protobuf.UInt64Value category_id = 4;
  // 目标品牌。
  google.protobuf.UInt64Value brand_id = 5;
  // 新状态。
  ProductStatus status = 6;
  // 主图。
  string main_image_url = 7;
  // 图集。
  repeated string gallery_image_urls = 8;
  // SEO 变更。
  SeoInfo seo_info = 9;
  // 重量。
  google.protobuf.DoubleValue weight = 10;
}

// 删除请求。
message DeleteProductRequest {
  // 目标 ID。
  uint64 id = 1;
}

// 商品检索请求。
message ListProductsRequest {
  // 页码。
  int32 page = 1;
  // 数量。
  int32 page_size = 2;
  // 分类过滤。
  uint64 category_id = 3;
  // 品牌过滤。
  uint64 brand_id = 4;
  // 状态过滤。
  ProductStatus status = 5;
  // 排序维度。
  string sort_by = 6;
}

// 列表响应。
message ListProductsResponse {
  // 结果列表。
  repeated ProductInfo products = 1;
  // 总数。
  int32 total = 2;
  // 当前页。
  int32 page = 3;
  // 翻页限制。
  int32 page_size = 4;
}

// 关联 SKU 请求。
message AddSKUsToProductRequest {
  // 主商品 ID。
  uint64 product_id = 1;
  // 规格项集合。
  repeated SKUCreate skus = 2;
}

// SKU 模板。
message SKUCreate {
  // 规格名称。
  string name = 1;
  // 价格（分）。
  int64 price = 2;
  // 初始库存。
  int32 stock_quantity = 3;
  // 图片。
  string image_url = 4;
  // 规格值对。
  repeated SpecValue spec_values = 5;
}

// 批量添加响应。
message AddSKUsToProductResponse {
  // 生成的 SKU 列表。
  repeated SKU created_skus = 1;
}

// SKU 修改请求。
message UpdateSKURequest {
  // 规格 ID。
  uint64 id = 1;
  // 新价格。
  google.protobuf.Int64Value price = 2;
  // 调整库存。
  google.protobuf.Int32Value stock_quantity = 3;
  // 切换图片。
  google.protobuf.StringValue image_url = 4;
}

// SKU 移除请求。
message DeleteSKURequest {
  // 所属商品 ID。
  uint64 product_id = 1;
  // 待删 ID 集合。
  repeated uint64 sku_ids = 2;
}

// SKU 单查。
message GetSKUByIDRequest {
  // 规格 ID。
  uint64 id = 1;
}

// 类目创建。
message CreateCategoryRequest {
  // 名称。
  string name = 1;
  // 父节点 ID。
  uint64 parent_id = 2;
  // 图标。
  string icon_url = 3;
  // 排序值。
  int32 sort_order = 4;
}

// 类目查询。
message GetCategoryByIDRequest {
  // 节点 ID。
  uint64 id = 1;
}

// 类目更新。
message UpdateCategoryRequest {
  // 节点 ID。
  uint64 id = 1;
  // 名称。
  google.protobuf.StringValue name = 2;
  // 父节点。
  google.protobuf.UInt64Value parent_id = 3;
  // 图标。
  google.protobuf.StringValue icon_url = 4;
  // 排序值。
  google.protobuf.Int32Value sort_order = 5;
}

// 类目移除。
message DeleteCategoryRequest {
  // 节点 ID。
  uint64 id = 1;
}

// 类目列表过滤。
message ListCategoriesRequest {
  // 目标父节点。
  uint64 parent_id = 1;
}

// 类目响应。
message ListCategoriesResponse {
  // 下级类目序列。
  repeated Category categories = 1;
}

// 品牌录入。
message CreateBrandRequest {
  // 品牌名。
  string name = 1;
  // Logo 链接。
  string logo_url = 2;
  // 介绍。
  string description = 3;
}

// 品牌单查。
message GetBrandByIDRequest {
  // 系统 ID。
  uint64 id = 1;
}

// 品牌修改。
message UpdateBrandRequest {
  // 目标 ID。
  uint64 id = 1;
  // 名称。
  google.protobuf.StringValue name = 2;
  // Logo。
  google.protobuf.StringValue logo_url = 3;
  // 介绍描述。
  google.protobuf.StringValue description = 4;
}

// 品牌移除。
message DeleteBrandRequest {
  // 系统 ID。
  uint64 id = 1;
}

// 品牌检索。
message ListBrandsRequest {
  // 页码。
  int32 page = 1;
  // 数量。
  int32 page_size = 2;
}

// 品牌列表响应。
message ListBrandsResponse {
  // 品牌记录序列。
  repeated Brand brands = 1;
  // 总记录数。
  int32 total = 2;
}
