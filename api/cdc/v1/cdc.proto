syntax = "proto3";

package api.cdc.v1;

import "google/protobuf/timestamp.proto";

option go_package = "ecommerce/api/cdc/v1;v1";

// CdcService 定义了变更数据捕获服务接口
service CdcService {
  // 模拟捕获数据库变更事件
  rpc CaptureChangeEvent(CaptureChangeEventRequest) returns (CaptureChangeEventResponse);
}

// ChangeEvent 变更事件
message ChangeEvent {
  string event_id = 1;
  string table_name = 2;
  string operation_type = 3; // INSERT, UPDATE, DELETE
  string primary_key_value = 4; // 主键值
  map<string, string> old_data = 5; // 旧数据 (JSON字符串)
  map<string, string> new_data = 6; // 新数据 (JSON字符串)
  google.protobuf.Timestamp event_timestamp = 7;
}

// CaptureChangeEventRequest 捕获变更事件请求
message CaptureChangeEventRequest {
  string table_name = 1;
  string operation_type = 2;
  string primary_key_value = 3;
  map<string, string> old_data = 4;
  map<string, string> new_data = 5;
}

// CaptureChangeEventResponse 捕获变更事件响应
message CaptureChangeEventResponse {
  string event_id = 1;
}
