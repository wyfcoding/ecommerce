syntax = "proto3";

package api.admin.v1;

import "google/protobuf/timestamp.proto";
// Import other services' proto files to reuse message types
import "api/product/v1/product.proto";
import "api/order/v1/order.proto";
import "api/user/v1/user.proto"; // Assuming user service proto exists
import "api/review/v1/review.proto"; // Assuming review service proto exists
import "api/coupon/v1/coupon.proto"; // Assuming coupon service proto exists

option go_package = "ecommerce/api/admin/v1;v1";

service Admin {
  // --- 认证 ---
  rpc AdminLogin(AdminLoginRequest) returns (AdminLoginResponse);

  // --- 用户管理 ---
  rpc ListUsers(ListUsersRequest) returns (ListUsersResponse);
  rpc GetUserDetails(GetUserDetailsRequest) returns (GetUserDetailsResponse);
  rpc UpdateUserStatus(UpdateUserStatusRequest) returns (UpdateUserStatusResponse);

  // --- 商品管理 ---
  rpc ListProducts(ListProductsRequest) returns (ListProductsResponse);
  // CreateProduct 接口已存在
  rpc UpdateProduct(UpdateProductRequest) returns (UpdateProductResponse);
  rpc DeleteProduct(DeleteProductRequest) returns (DeleteProductResponse);

  // --- 订单管理 ---
  rpc ListOrders(ListOrdersRequest) returns (ListOrdersResponse) {}
  rpc GetOrderDetail(GetOrderDetailRequest) returns (GetOrderDetailResponse) {}
  rpc ShipOrder(ShipOrderRequest) returns (ShipOrderResponse) {}
  rpc UpdateOrderStatus(UpdateOrderStatusRequest) returns (UpdateOrderStatusResponse);

  // --- 评论管理 ---
  rpc ListReviews(ListReviewsRequest) returns (ListReviewsResponse);
  rpc ModerateReview(ModerateReviewRequest) returns (ModerateReviewResponse);

  // --- 优惠券管理 ---
  rpc CreateCoupon(CreateCouponRequest) returns (CreateCouponResponse);
  rpc ListCoupons(ListCouponsRequest) returns (ListCouponsResponse);
  rpc UpdateCoupon(UpdateCouponRequest) returns (UpdateCouponResponse);
  rpc DeleteCoupon(DeleteCouponRequest) returns (DeleteCouponResponse);

  // --- RBAC 管理 ---
  rpc CreateRole(CreateRoleRequest) returns (Role) {}
  rpc ListRoles(ListRolesRequest) returns (ListRolesResponse) {}
  rpc UpdateRolePermissions(UpdateRolePermissionsRequest) returns (UpdateRolePermissionsResponse) {}

  rpc ListPermissions(ListPermissionsRequest) returns (ListPermissionsResponse) {}

  rpc CreateAdminUser(CreateAdminUserRequest) returns (AdminUser) {}
  rpc ListAdminUsers(ListAdminUsersRequest) returns (ListAdminUsersResponse) {}
  rpc UpdateUserRoles(UpdateUserRolesRequest) returns (UpdateUserRolesResponse) {}
}

// --- Messages ---

message AdminLoginRequest {
  string username = 1;
  string password = 2;
}
message AdminLoginResponse {
  string token = 1;
}

// GetOrderDetail
message GetOrderDetailRequest {
  uint64 order_id = 1;
}
message GetOrderDetailResponse {
  // 复用 order.v1 的消息体
  api.order.v1.OrderInfo order = 1;
  repeated api.order.v1.OrderItem items = 2;
}

// CreateProduct
message CreateProductRequest {
  api.product.v1.SpuInfo spu = 1;
  repeated api.product.v1.SkuInfo skus = 2;
}
message CreateProductResponse {
  uint64 spu_id = 1;
}

message ListOrdersRequest {
  uint32 page = 1;
  uint32 page_size = 2;
  // 可以增加按 user_id, order_id, status 等过滤条件
  optional uint64 user_id = 3;
  optional int32 status = 4;
}
message ListOrdersResponse {
  repeated api.order.v1.OrderInfo orders = 1;
  uint64 total = 2;
}

message ShipOrderRequest {
  uint64 order_id = 1;
  string tracking_company = 2; // 物流公司
  string tracking_number = 3;  // 物流单号
}
message ShipOrderResponse {
  // 成功时为空
}

message UpdateOrderStatusRequest {
  uint64 order_id = 1;
  string status = 2; // New status, e.g., "SHIPPED", "DELIVERED", "CANCELED"
}
message UpdateOrderStatusResponse {
  api.order.v1.OrderInfo order = 1;
}

// User Management Messages
message ListUsersRequest {
  uint32 page = 1;
  uint32 page_size = 2;
  optional string search_query = 3; // Search by username, email, etc.
  optional string status_filter = 4; // e.g., "ACTIVE", "INACTIVE", "BANNED"
}
message ListUsersResponse {
  repeated api.user.v1.UserInfo users = 1;
  uint64 total = 2;
}
message GetUserDetailsRequest {
  string user_id = 1;
}
message GetUserDetailsResponse {
  api.user.v1.UserInfo user = 1;
}
message UpdateUserStatusRequest {
  string user_id = 1;
  string status = 2; // e.g., "ACTIVE", "INACTIVE", "BANNED"
}
message UpdateUserStatusResponse {
  api.user.v1.UserInfo user = 1;
}

// Product Management Messages
message ListProductsRequest {
  uint32 page = 1;
  uint32 page_size = 2;
  optional string search_query = 3;
  optional string category_id = 4;
  optional string status_filter = 5; // e.g., "ACTIVE", "INACTIVE", "DRAFT"
}
message ListProductsResponse {
  repeated api.product.v1.SpuInfo products = 1;
  uint64 total = 2;
}
message UpdateProductRequest {
  string product_id = 1;
  api.product.v1.SpuInfo spu = 2; // Full SPU info to update
  repeated api.product.v1.SkuInfo skus = 3; // Full SKU info to update
}
message UpdateProductResponse {
  api.product.v1.SpuInfo spu = 1;
}
message DeleteProductRequest {
  string product_id = 1;
}
message DeleteProductResponse {
  bool success = 1;
  string message = 2;
}

// Review Management Messages
message ListReviewsRequest {
  uint32 page = 1;
  uint32 page_size = 2;
  optional string product_id = 3;
  optional string user_id = 4;
  optional string status_filter = 5; // e.g., "PENDING", "APPROVED", "REJECTED"
}
message ListReviewsResponse {
  repeated api.review.v1.ReviewInfo reviews = 1;
  uint64 total = 2;
}
message ModerateReviewRequest {
  string review_id = 1;
  string status = 2; // e.g., "APPROVED", "REJECTED", "DELETED"
  optional string moderation_notes = 3;
}
message ModerateReviewResponse {
  api.review.v1.ReviewInfo review = 1;
}

// Coupon Management Messages
message CreateCouponRequest {
  string code = 1;
  string description = 2;
  double discount_value = 3;
  string type = 4; // e.g., FIXED_AMOUNT, PERCENTAGE
  google.protobuf.Timestamp valid_from = 5;
  google.protobuf.Timestamp valid_to = 6;
  optional int32 max_usage = 7;
}
message CreateCouponResponse {
  api.coupon.v1.CouponInfo coupon = 1;
}
message ListCouponsRequest {
  uint32 page = 1;
  uint32 page_size = 2;
  optional bool active_only = 3;
  optional string search_query = 4;
}
message ListCouponsResponse {
  repeated api.coupon.v1.CouponInfo coupons = 1;
  uint64 total = 2;
}
message UpdateCouponRequest {
  string coupon_id = 1;
  string code = 2;
  string description = 3;
  double discount_value = 4;
  string type = 5;
  google.protobuf.Timestamp valid_from = 6;
  google.protobuf.Timestamp valid_to = 7;
  bool is_active = 8;
  optional int32 max_usage = 9;
}
message UpdateCouponResponse {
  api.coupon.v1.CouponInfo coupon = 1;
}
message DeleteCouponRequest {
  string coupon_id = 1;
}
message DeleteCouponResponse {
  bool success = 1;
  string message = 2;
}

message Role {
  uint32 id = 1;
  string name = 2;
  string slug = 3;
}
message Permission {
  uint32 id = 1;
  string name = 2;
  string slug = 3;
}
message AdminUser {
  uint32 id = 1;
  string username = 2;
  string name = 3;
  int32 status = 4;
}

message CreateRoleRequest { string name = 1; string slug = 2; }
message ListRolesRequest {}
message ListRolesResponse { repeated Role roles = 1; }
message UpdateRolePermissionsRequest {
  uint32 role_id = 1;
  repeated uint32 permission_ids = 2;
}
message UpdateRolePermissionsResponse {}

message ListPermissionsRequest {}
message ListPermissionsResponse { repeated Permission permissions = 1; }

message CreateAdminUserRequest { string username = 1; string password = 2; string name = 3; }
message ListAdminUsersRequest {}
message ListAdminUsersResponse { repeated AdminUser users = 1; }
message UpdateUserRolesRequest {
  uint32 user_id = 1;
  repeated uint32 role_ids = 2;
}
message UpdateUserRolesResponse {}