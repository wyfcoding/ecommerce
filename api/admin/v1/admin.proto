syntax = "proto3";

package admin.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/goapi/admin/v1;v1";

// 后台管理员账号服务，处理管理端权限、系统配置及操作审计。
service Admin {
  // --- 管理员账号管理 ---
  // 录入新的管理员。
  rpc CreateAdminUser(CreateAdminUserRequest) returns (CreateAdminUserResponse);
  // 获取管理员详情。
  rpc GetAdminUser(GetAdminUserRequest) returns (GetAdminUserResponse);
  // 修改管理员资料或角色。
  rpc UpdateAdminUser(UpdateAdminUserRequest) returns (UpdateAdminUserResponse);
  // 注销管理员账号。
  rpc DeleteAdminUser(DeleteAdminUserRequest) returns (google.protobuf.Empty);
  // 分页查询管理员列表。
  rpc ListAdminUsers(ListAdminUsersRequest) returns (ListAdminUsersResponse);

  // --- 角色与权限管理 ---
  // 定义管理角色。
  rpc CreateRole(CreateRoleRequest) returns (CreateRoleResponse);
  // 查询角色详情。
  rpc GetRole(GetRoleRequest) returns (GetRoleResponse);
  // 修改角色权限配置。
  rpc UpdateRole(UpdateRoleRequest) returns (UpdateRoleResponse);
  // 移除管理角色。
  rpc DeleteRole(DeleteRoleRequest) returns (google.protobuf.Empty);
  // 列出所有可用角色。
  rpc ListRoles(ListRolesRequest) returns (ListRolesResponse);

  // --- 权限项管理 ---
  // 注册权限原子项。
  rpc CreatePermission(CreatePermissionRequest) returns (CreatePermissionResponse);
  // 查询权限项。
  rpc GetPermission(GetPermissionRequest) returns (GetPermissionResponse);
  // 列出所有权限点。
  rpc ListPermissions(ListPermissionsRequest) returns (ListPermissionsResponse);

  // --- 审计管理 ---
  // 查询管理员操作轨迹。
  rpc ListAuditLogs(ListAuditLogsRequest) returns (ListAuditLogsResponse);

  // --- 业务配置 ---
  // 读取系统全局开关。
  rpc GetSystemSetting(GetSystemSettingRequest) returns (GetSystemSettingResponse);
  // 实时修改系统配置。
  rpc UpdateSystemSetting(UpdateSystemSettingRequest) returns (UpdateSystemSettingResponse);
}

// 管理员实体。
message AdminUser {
  // 系统 ID。
  uint64 id = 1;
  // 登录名。
  string username = 2;
  // 工作邮箱。
  string email = 3;
  // 显示名称。
  string nickname = 4;
  // 是否允许登录。
  bool is_active = 5;
  // 拥有的角色标识序列。
  repeated string roles = 6;
  // 录入时间。
  google.protobuf.Timestamp created_at = 7;
  // 修改时间。
  google.protobuf.Timestamp updated_at = 8;
}

// 管理角色。
message Role {
  // 角色 ID。
  uint64 id = 1;
  // 唯一名称。
  string name = 2;
  // 职能描述。
  string description = 3;
  // 权限点序列。
  repeated string permissions = 4;
  // 录入时间。
  google.protobuf.Timestamp created_at = 5;
  // 修改时间。
  google.protobuf.Timestamp updated_at = 6;
}

// 权限原子项。
message Permission {
  // 权限 ID。
  uint64 id = 1;
  // 权限名。
  string name = 2;
  // 业务含义描述。
  string description = 3;
}

// 管理端操作日志。
message AuditLog {
  // 日志 ID。
  uint64 id = 1;
  // 操作管理员 ID。
  uint64 admin_user_id = 2;
  // 管理员账号。
  string admin_username = 3;
  // 操作行为名。
  string action = 4;
  // 目标资源类型。
  string entity_type = 5;
  // 目标 ID。
  uint64 entity_id = 6;
  // 变更前后 JSON。
  string details = 7;
  // 来源 IP。
  string ip_address = 8;
  // 记录时间。
  google.protobuf.Timestamp created_at = 9;
}

// 系统全局动态设置。
message SystemSetting {
  // 配置键。
  string key = 1;
  // 当前值。
  string value = 2;
  // 描述。
  string description = 3;
  // 修改时间。
  google.protobuf.Timestamp updated_at = 4;
}

// 创建管理员请求。
message CreateAdminUserRequest {
  // 登录名。
  string username = 1;
  // 初始密码。
  string password = 2;
  // 邮箱。
  string email = 3;
  // 昵称。
  string nickname = 4;
  // 授予角色 ID 集。
  repeated uint64 role_ids = 5;
}

// 创建管理员结果。
message CreateAdminUserResponse {
  // 管理员实体。
  AdminUser admin_user = 1;
}

// 管理员单查。
message GetAdminUserRequest {
  // 系统 ID。
  uint64 id = 1;
}

// 单查响应。
message GetAdminUserResponse {
  // 管理员实体。
  AdminUser admin_user = 1;
}

// 修改管理员请求。
message UpdateAdminUserRequest {
  // 目标 ID。
  uint64 id = 1;
  // 修改名。
  string username = 2;
  // 修改邮箱。
  string email = 3;
  // 修改昵称。
  string nickname = 4;
  // 切换开关。
  bool is_active = 5;
  // 全量角色 ID 覆盖。
  repeated uint64 role_ids = 6;
}

// 修改管理员响应。
message UpdateAdminUserResponse {
  // 管理员实体。
  AdminUser admin_user = 1;
}

// 管理员移除。
message DeleteAdminUserRequest {
  // 系统 ID。
  uint64 id = 1;
}

// 管理员分页请求。
message ListAdminUsersRequest {
  // 数量。
  int32 page_size = 1;
  // 令牌。
  int32 page_token = 2;
  // 搜索词。
  string query = 3;
}

// 管理员列表响应。
message ListAdminUsersResponse {
  // 管理员序列。
  repeated AdminUser admin_users = 1;
  // 总笔数。
  int32 total_count = 2;
}

// 角色创建。
message CreateRoleRequest {
  // 名称。
  string name = 1;
  // 描述。
  string description = 2;
  // 权限 ID 集合。
  repeated uint64 permission_ids = 3;
}

// 角色结果。
message CreateRoleResponse {
  // 角色实体。
  Role role = 1;
}

// 角色查询。
message GetRoleRequest {
  // 角色 ID。
  uint64 id = 1;
}

// 角色响应。
message GetRoleResponse {
  // 角色实体。
  Role role = 1;
}

// 角色修改。
message UpdateRoleRequest {
  // 目标 ID。
  uint64 id = 1;
  // 修改名。
  string name = 2;
  // 修改描述。
  string description = 3;
  // 全量权限 ID 覆盖。
  repeated uint64 permission_ids = 4;
}

// 角色修改结果。
message UpdateRoleResponse {
  // 角色实体。
  Role role = 1;
}

// 角色删除。
message DeleteRoleRequest {
  // 角色 ID。
  uint64 id = 1;
}

// 角色分页。
message ListRolesRequest {
  // 数量。
  int32 page_size = 1;
  // 令牌。
  int32 page_token = 2;
}

// 角色列表。
message ListRolesResponse {
  // 角色序列。
  repeated Role roles = 1;
  // 总数。
  int32 total_count = 2;
}

// 权限项创建。
message CreatePermissionRequest {
  // 名称。
  string name = 1;
  // 说明。
  string description = 2;
}

// 权限项结果。
message CreatePermissionResponse {
  // 权限实体。
  Permission permission = 1;
}

// 权限项查询。
message GetPermissionRequest {
  // 权限 ID。
  uint64 id = 1;
}

// 权限项响应。
message GetPermissionResponse {
  // 权限实体。
  Permission permission = 1;
}

// 权限分页请求。
message ListPermissionsRequest {
  // 数量。
  int32 page_size = 1;
  // 令牌。
  int32 page_token = 2;
}

// 权限列表响应。
message ListPermissionsResponse {
  // 权限集合。
  repeated Permission permissions = 1;
  // 总数。
  int32 total_count = 2;
}

// 审计查询。
message ListAuditLogsRequest {
  // 数量。
  int32 page_size = 1;
  // 令牌。
  int32 page_token = 2;
  // 管理员 ID。
  uint64 admin_user_id = 3;
  // 动作。
  string action = 4;
  // 实体类。
  string entity_type = 5;
  // 实体 ID。
  uint64 entity_id = 6;
  // 起始。
  google.protobuf.Timestamp start_time = 7;
  // 结束。
  google.protobuf.Timestamp end_time = 8;
}

// 审计响应。
message ListAuditLogsResponse {
  // 审计日志序列。
  repeated AuditLog audit_logs = 1;
  // 总笔数。
  int32 total_count = 2;
}

// 配置获取。
message GetSystemSettingRequest {
  // 配置键。
  string key = 1;
}

// 配置结果。
message GetSystemSettingResponse {
  // 配置项。
  SystemSetting setting = 1;
}

// 配置更新。
message UpdateSystemSettingRequest {
  // 键。
  string key = 1;
  // 新值。
  string value = 2;
  // 说明。
  string description = 3;
}

// 配置修改回执。
message UpdateSystemSettingResponse {
  // 配置项。
  SystemSetting setting = 1;
}
