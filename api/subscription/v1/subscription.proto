syntax = "proto3";

package api.subscription.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/subscription/v1;subscriptionv1";

// 订阅会员服务，管理各类增值服务的收费计划、用户契约及有效期自动续费。
service Subscription {
  // 定义并发布一套新的付费权益套餐。
  rpc CreatePlan(CreatePlanRequest) returns (CreatePlanResponse);

  // 获取当前所有面向用户开放的套餐配置。
  rpc ListPlans(google.protobuf.Empty) returns (ListPlansResponse);

  // 用户发起购买并确认订阅特定套餐。
  rpc Subscribe(SubscribeRequest) returns (SubscribeResponse);

  // 物理或逻辑终止当前的订阅协议。
  rpc Cancel(CancelRequest) returns (google.protobuf.Empty);

  // 手动延长现有订阅合约的有效期。
  rpc Renew(RenewRequest) returns (google.protobuf.Empty);

  // 分页列表检索用户的订阅历史。
  rpc ListSubscriptions(ListSubscriptionsRequest) returns (ListSubscriptionsResponse);
}

// 会员套餐配置。
message SubscriptionPlan {
  // 唯一 ID。
  uint64 id = 1;
  // 显示名 (如 "月度黄金会员")。
  string name = 2;
  // 权益详细介绍。
  string description = 3;
  // 售卖价。
  uint64 price = 4;
  // 赋予的有效天数。
  int32 duration = 5;
  // 套餐包含的权益标签集。
  repeated string features = 6;
  // 发售开关。
  bool enabled = 7;
  // 录入时间。
  google.protobuf.Timestamp created_at = 8;
  // 修改时间。
  google.protobuf.Timestamp updated_at = 9;
}

// 用户订阅契约。
message Subscription {
  // 唯一记录 ID。
  uint64 id = 1;
  // 归属人。
  uint64 user_id = 2;
  // 关联套餐 ID。
  uint64 plan_id = 3;
  // 当前存续状态 (0:无效, 1:存续中)。
  int32 status = 4;
  // 生效起始。
  google.protobuf.Timestamp start_date = 5;
  // 合约到期。
  google.protobuf.Timestamp end_date = 6;
  // 自动续费标识。
  bool auto_renew = 7;
  // 协议解约时刻。
  google.protobuf.Timestamp canceled_at = 8;
  // 合同创建。
  google.protobuf.Timestamp created_at = 9;
  // 状态变更。
  google.protobuf.Timestamp updated_at = 10;
}

// 套餐定义请求。
message CreatePlanRequest {
  // 名称。
  string name = 1;
  // 简介。
  string description = 2;
  // 售价。
  uint64 price = 3;
  // 时长天数。
  int32 duration = 4;
  // 权益列表。
  repeated string features = 5;
}

// 套餐定义响应。
message CreatePlanResponse {
  // 套餐档案。
  SubscriptionPlan plan = 1;
}

// 套餐列表结果。
message ListPlansResponse {
  // 套餐序列。
  repeated SubscriptionPlan plans = 1;
}

// 签约请求。
message SubscribeRequest {
  // 用户。
  uint64 user_id = 1;
  // 选中的套餐。
  uint64 plan_id = 2;
}

// 签约结果。
message SubscribeResponse {
  // 契约档案。
  Subscription subscription = 1;
}

// 解约请求。
message CancelRequest {
  // 契约 ID。
  uint64 id = 1;
}

// 续期请求。
message RenewRequest {
  // 契约 ID。
  uint64 id = 1;
}

// 合约列表查询。
message ListSubscriptionsRequest {
  // 用户。
  uint64 user_id = 1;
  // 页码。
  int32 page = 2;
  // 数量。
  int32 page_size = 3;
}

// 合约列表结果。
message ListSubscriptionsResponse {
  // 契约序列。
  repeated Subscription subscriptions = 1;
  // 总笔数。
  int64 total_count = 2;
}
