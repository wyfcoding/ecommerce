syntax = "proto3";

package api.subscription.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/wyfcoding/ecommerce/api/subscription/v1;subscriptionv1";

service SubscriptionService {
  // Plan Management
  rpc CreatePlan(CreatePlanRequest) returns (CreatePlanResponse);
  rpc ListPlans(google.protobuf.Empty) returns (ListPlansResponse);

  // Subscription Management
  rpc Subscribe(SubscribeRequest) returns (SubscribeResponse);
  rpc Cancel(CancelRequest) returns (google.protobuf.Empty);
  rpc Renew(RenewRequest) returns (google.protobuf.Empty);
  rpc ListSubscriptions(ListSubscriptionsRequest) returns (ListSubscriptionsResponse);
}

message SubscriptionPlan {
  uint64 id = 1;
  string name = 2;
  string description = 3;
  uint64 price = 4;
  int32 duration = 5;
  repeated string features = 6;
  bool enabled = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message Subscription {
  uint64 id = 1;
  uint64 user_id = 2;
  uint64 plan_id = 3;
  int32 status = 4;
  google.protobuf.Timestamp start_date = 5;
  google.protobuf.Timestamp end_date = 6;
  bool auto_renew = 7;
  google.protobuf.Timestamp canceled_at = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
}

message CreatePlanRequest {
  string name = 1;
  string description = 2;
  uint64 price = 3;
  int32 duration = 4;
  repeated string features = 5;
}

message CreatePlanResponse {
  SubscriptionPlan plan = 1;
}

message ListPlansResponse {
  repeated SubscriptionPlan plans = 1;
}

message SubscribeRequest {
  uint64 user_id = 1;
  uint64 plan_id = 2;
}

message SubscribeResponse {
  Subscription subscription = 1;
}

message CancelRequest {
  uint64 id = 1;
}

message RenewRequest {
  uint64 id = 1;
}

message ListSubscriptionsRequest {
  uint64 user_id = 1;
  int32 page = 2;
  int32 page_size = 3;
}

message ListSubscriptionsResponse {
  repeated Subscription subscriptions = 1;
  int64 total_count = 2;
}
