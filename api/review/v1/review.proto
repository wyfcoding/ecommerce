syntax = "proto3";

package api.review.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/goapi/review/v1;v1";

// 商品评价服务，处理用户的商品评分、文字内容及历史查询。
service Review {
  // 提交新评价。
  rpc CreateReview(CreateReviewRequest) returns (CreateReviewResponse);

  // 获取特定商品的全部评价。
  rpc ListProductReviews(ListProductReviewsRequest) returns (ListProductReviewsResponse);

  // 获取特定用户发布的所有评价。
  rpc ListUserReviews(ListUserReviewsRequest) returns (ListUserReviewsResponse);

  // 查询商品的平均评分及评价总数。
  rpc GetProductRating(GetProductRatingRequest) returns (GetProductRatingResponse);
}

// 评价详情数据。
message ReviewInfo {
  // 评价唯一 ID。
  string id = 1;
  // 关联商品 ID。
  string product_id = 2;
  // 发布用户 ID。
  string user_id = 3;
  // 评分星级 (1-5)。
  int32 rating = 4;
  // 评价标题。
  string title = 5;
  // 评价详细文字。
  string content = 6;
  // 发布时间。
  google.protobuf.Timestamp created_at = 7;
  // 最后修改时间。
  google.protobuf.Timestamp updated_at = 8;
}

// 发布评价请求。
message CreateReviewRequest {
  // 商品 ID。
  string product_id = 1;
  // 用户 ID。
  string user_id = 2;
  // 星级评分。
  int32 rating = 3;
  // 标题。
  string title = 4;
  // 正文。
  string content = 5;
}

// 发布结果。
message CreateReviewResponse {
  // 生成的评价。
  ReviewInfo review = 1;
}

// 商品评价查询。
message ListProductReviewsRequest {
  // 商品 ID。
  string product_id = 1;
  // 每页条数。
  int32 page_size = 2;
  // 分页令牌。
  int32 page_token = 3;
}

// 商品评价列表响应。
message ListProductReviewsResponse {
  // 评价列表。
  repeated ReviewInfo reviews = 1;
  // 总条数。
  int32 total_count = 2;
  // 当前平均分。
  double average_rating = 3;
}

// 用户评价查询。
message ListUserReviewsRequest {
  // 用户 ID。
  string user_id = 1;
  // 每页条数。
  int32 page_size = 2;
  // 令牌。
  int32 page_token = 3;
}

// 用户评价列表响应。
message ListUserReviewsResponse {
  // 评价记录。
  repeated ReviewInfo reviews = 1;
  // 总记录数。
  int32 total_count = 2;
}

// 评分统计查询。
message GetProductRatingRequest {
  // 商品 ID。
  string product_id = 1;
}

// 评分统计响应。
message GetProductRatingResponse {
  // 平均星级。
  double average_rating = 1;
  // 总评价数。
  int32 total_reviews = 2;
}
