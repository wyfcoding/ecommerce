syntax = "proto3";

package api.data_warehouse_query.v1;

option go_package = "github.com/wyfcoding/ecommerce/go-api/data_warehouse_query/v1;v1";

// 数据仓库查询服务，负责执行 OLAP 复杂查询并获取大规模分析结果。
service DataWarehouseQuery {
  // 提交一个 SQL 或特定引擎的查询任务。
  rpc ExecuteQuery(ExecuteQueryRequest) returns (ExecuteQueryResponse);

  // 分页获取已执行查询的结果集。
  rpc GetQueryResult(GetQueryResultRequest) returns (GetQueryResultResponse);
}

// 查询提交请求。
message ExecuteQueryRequest {
  // SQL 或查询语句。
  string query_string = 1;
  // 注入参数。
  map<string, string> query_params = 2;
  // 目标引擎 (Presto, Hive, Spark)。
  optional string query_engine = 3;
}

// 提交结果。
message ExecuteQueryResponse {
  // 任务 ID。
  string query_id = 1;
  // 初始执行状态。
  string status = 2;
}

// 结果拉取请求。
message GetQueryResultRequest {
  // 任务 ID。
  string query_id = 1;
  // 每页行数。
  optional int32 page_size = 2;
  // 目标页码。
  optional int32 page_number = 3;
}

// 数据行。
message QueryRow {
  // 列名与值的映射。
  map<string, string> columns = 1;
}

// 结果响应。
message GetQueryResultResponse {
  // 任务 ID。
  string query_id = 1;
  // 任务当前状态。
  string status = 2;
  // 命中的数据行。
  repeated QueryRow rows = 3;
  // 是否还有更多结果。
  bool has_more = 4;
}
