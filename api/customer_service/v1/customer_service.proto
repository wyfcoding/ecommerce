syntax = "proto3";

package api.customer_service.v1;

import "google/protobuf/timestamp.proto";

option go_package = "ecommerce/api/customer_service/v1;v1";

// CustomerService 定义了客户服务接口
service CustomerService {
  // 创建工单
  rpc CreateTicket(CreateTicketRequest) returns (Ticket);

  // 获取工单详情
  rpc GetTicket(GetTicketRequest) returns (Ticket);

  // 添加工单消息
  rpc AddTicketMessage(AddTicketMessageRequest) returns (TicketMessage);

  // 列出用户工单
  rpc ListTickets(ListTicketsRequest) returns (ListTicketsResponse);
}

// Ticket 工单信息
message Ticket {
  uint64 ticket_id = 1;
  uint64 user_id = 2;
  string subject = 3;
  string description = 4;
  string status = 5; // OPEN, IN_PROGRESS, RESOLVED, CLOSED
  google.protobuf.Timestamp created_at = 6;
  google.protobuf.Timestamp updated_at = 7;
  repeated TicketMessage messages = 8;
}

// TicketMessage 工单消息
message TicketMessage {
  uint64 message_id = 1;
  uint64 ticket_id = 2;
  uint64 sender_id = 3; // 用户ID或客服ID
  string sender_type = 4; // USER, AGENT
  string content = 5;
  google.protobuf.Timestamp created_at = 6;
}

// CreateTicketRequest 创建工单请求
message CreateTicketRequest {
  uint64 user_id = 1;
  string subject = 2;
  string description = 3;
}

// GetTicketRequest 获取工单请求
message GetTicketRequest {
  uint64 ticket_id = 1;
}

// AddTicketMessageRequest 添加工单消息请求
message AddTicketMessageRequest {
  uint64 ticket_id = 1;
  uint64 sender_id = 2;
  string sender_type = 3;
  string content = 4;
}

// ListTicketsRequest 列出工单请求
message ListTicketsRequest {
  uint64 user_id = 1;
  string status = 2; // Optional filter
}

// ListTicketsResponse 列出工单响应
message ListTicketsResponse {
  repeated Ticket tickets = 1;
}
