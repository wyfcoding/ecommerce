syntax = "proto3";

package api.auth.v1;

option go_package = "github.com/wyfcoding/ecommerce/go-api/auth/v1;v1";

// 统一认证与授权服务，负责用户身份校验、令牌分发及有效期管理。
service Auth {
  // 验证用户账密凭据，成功后颁发 JWT 访问令牌。
  rpc Authenticate(AuthenticateRequest) returns (AuthenticateResponse);

  // 使用刷新令牌获取新的访问令牌，延长会话生命周期。
  rpc RefreshToken(RefreshTokenRequest) returns (AuthenticateResponse);

  // 验证现有令牌的合法性、完整性及是否过期。
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
}

// 认证请求。
message AuthenticateRequest {
  // 账号名。
  string username = 1;
  // 凭证原文。
  string password = 2;
}

// 认证响应。
message AuthenticateResponse {
  // JWT 访问令牌。
  string token = 1;
  // 过期时间戳。
  int64 expires_at = 2;
}

// 令牌刷新请求。
message RefreshTokenRequest {
  // 长效刷新令牌。
  string refresh_token = 1;
}

// 验证请求。
message ValidateTokenRequest {
  // 待核验令牌。
  string token = 1;
}

// 验证响应。
message ValidateTokenResponse {
  // 令牌是否有效。
  bool valid = 1;
  // 解析出的用户 ID。
  uint64 user_id = 2;
  // 解析出的用户名。
  string username = 3;
  // 到期日期戳。
  int64 expires_at = 4;
}
