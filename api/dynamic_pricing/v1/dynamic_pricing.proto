syntax = "proto3";

package api.dynamic_pricing.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/dynamic_pricing/v1;v1";

// 动态定价服务，基于库存、需求及竞品价格实时计算最优售价。
service DynamicPricingService {
  // 根据多因子实时计算商品的动态价格。
  rpc CalculatePrice(CalculatePriceRequest) returns (CalculatePriceResponse);

  // 查询指定商品当前生效的最新的动态价格。
  rpc GetLatestPrice(GetLatestPriceRequest) returns (GetLatestPriceResponse);

  // --- 策略管理 ---
  // 保存或修改定价算法策略配置。
  rpc SaveStrategy(SaveStrategyRequest) returns (google.protobuf.Empty);

  // 分页列出系统中的定价策略。
  rpc ListStrategies(ListStrategiesRequest) returns (ListStrategiesResponse);
}

// 调价请求。
message CalculatePriceRequest {
  // SKU ID。
  uint64 sku_id = 1;
  // 成本价。
  int64 base_price = 2;
  // 实时可用库存。
  int32 current_stock = 3;
  // 投放总库存。
  int32 total_stock = 4;
  // 24小时内实时销量需求。
  int32 daily_demand = 5;
  // 历史日均销量。
  int32 average_daily_demand = 6;
  // 采集到的竞争对手最低售价。
  int64 competitor_price = 7;
}

// 调价结果详情。
message DynamicPrice {
  // SKU ID。
  uint64 sku_id = 1;
  // 原始价格。
  int64 base_price = 2;
  // 计算后的最终售价。
  int64 final_price = 3;
  // 价格调整总幅度（百分比）。
  double price_adjustment = 4;
  // 库存稀缺性系数影响值。
  double inventory_factor = 5;
  // 需求热度系数影响值。
  double demand_factor = 6;
  // 竞品对标系数影响值。
  double competitor_factor = 7;
  // 价格生效起始时间。
  google.protobuf.Timestamp effective_time = 8;
  // 价格失效过期时间。
  google.protobuf.Timestamp expiry_time = 9;
}

// 计算响应。
message CalculatePriceResponse {
  // 价格对象。
  DynamicPrice price = 1;
}

// 查询请求。
message GetLatestPriceRequest {
  // SKU ID。
  uint64 sku_id = 1;
}

// 查询响应。
message GetLatestPriceResponse {
  // 价格对象。
  DynamicPrice price = 1;
}

// 定价策略规则配置。
message PricingStrategy {
  // 唯一 ID。
  uint64 id = 1;
  // 目标 SKU。
  uint64 sku_id = 2;
  // 策略类别 (INVENTORY_BASED, DEMAND_BASED)。
  string strategy_type = 3;
  // 允许的最低底价限制。
  int64 min_price = 4;
  // 允许的最高天花板价。
  int64 max_price = 5;
  // 触发调价的库存阈值。
  int32 inventory_threshold = 6;
  // 触发调价的需求阈值。
  int32 demand_threshold = 7;
  // 竞品对标的偏移值（如固定便宜 5 分）。
  int64 competitor_price_offset = 8;
  // 是否启用该策略。
  bool enabled = 9;
}

// 策略保存请求。
message SaveStrategyRequest {
  // 策略详情。
  PricingStrategy strategy = 1;
}

// 策略查询。
message ListStrategiesRequest {
  // 数量。
  uint32 page_size = 1;
  // 页码。
  uint32 page_num = 2;
}

// 策略查询结果。
message ListStrategiesResponse {
  // 策略列表数据。
  repeated PricingStrategy strategies = 1;
  // 总笔数。
  uint64 total_count = 2;
}
