syntax = "proto3";

package api.logistics.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/logistics/v1;v1";

// 物流服务，负责运单管理、轨迹追踪及配送路线优化。
service Logistics {
  // 创建新物流单。
  rpc CreateLogistics(CreateLogisticsRequest) returns (CreateLogisticsResponse);

  // 获取物流详细信息。
  rpc GetLogistics(GetLogisticsRequest) returns (GetLogisticsResponse);

  // 根据运单号查询物流详情。
  rpc GetLogisticsByTrackingNo(GetLogisticsByTrackingNoRequest) returns (GetLogisticsResponse);

  // 手动或自动更新物流状态。
  rpc UpdateStatus(UpdateStatusRequest) returns (google.protobuf.Empty);

  // 添加物流流转轨迹点。
  rpc AddTrace(AddTraceRequest) returns (google.protobuf.Empty);

  // 设置预计送达时间。
  rpc SetEstimatedTime(SetEstimatedTimeRequest) returns (google.protobuf.Empty);

  // 分页列出物流单。
  rpc ListLogistics(ListLogisticsRequest) returns (ListLogisticsResponse);

  // 计算并优化配送路线。
  rpc OptimizeDeliveryRoute(OptimizeDeliveryRouteRequest) returns (OptimizeDeliveryRouteResponse);
}

// 物流信息实体。
message Logistics {
  // 唯一 ID。
  uint64 id = 1;
  // 关联订单 ID。
  uint64 order_id = 2;
  // 订单编号快照。
  string order_no = 3;
  // 物流运单号。
  string tracking_no = 4;
  // 承运商名称（如顺丰、中通）。
  string carrier = 5;
  // 承运商代码。
  string carrier_code = 6;
  // 发货人姓名。
  string sender_name = 7;
  // 发货人电话。
  string sender_phone = 8;
  // 发货详细地址。
  string sender_address = 9;
  // 收货人姓名。
  string receiver_name = 10;
  // 收货人电话。
  string receiver_phone = 11;
  // 收货详细地址。
  string receiver_address = 12;
  // 发货地纬度。
  double sender_lat = 13;
  // 发货地经度。
  double sender_lon = 14;
  // 收货地纬度。
  double receiver_lat = 15;
  // 收货地经度。
  double receiver_lon = 16;
  // 物流状态。
  int32 status = 17;
  // 当前包裹位置描述。
  string current_location = 18;
  // 预计送达时间。
  google.protobuf.Timestamp estimated_time = 19;
  // 实际送达时间。
  google.protobuf.Timestamp delivered_at = 20;
  // 历史轨迹点列表。
  repeated LogisticsTrace traces = 21;
  // 规划的配送路线。
  DeliveryRoute route = 22;
  // 创建时间。
  google.protobuf.Timestamp created_at = 23;
  // 最后更新时间。
  google.protobuf.Timestamp updated_at = 24;
}

// 物流轨迹节点。
message LogisticsTrace {
  // 唯一 ID。
  uint64 id = 1;
  // 关联物流单 ID。
  uint64 logistics_id = 2;
  // 运单号。
  string tracking_no = 3;
  // 轨迹点地理位置。
  string location = 4;
  // 轨迹详情描述。
  string description = 5;
  // 该节点对应的状态。
  string status = 6;
  // 记录时间。
  google.protobuf.Timestamp created_at = 7;
}

// 配送路径数据。
message DeliveryRoute {
  // 唯一 ID。
  uint64 id = 1;
  // 关联物流单 ID。
  uint64 logistics_id = 2;
  // 路线坐标或关键点 JSON 数据。
  string route_data = 3;
  // 总配送距离（单位：米）。
  double distance = 4;
}

// 创建物流请求。
message CreateLogisticsRequest {
  // 订单 ID。
  uint64 order_id = 1;
  // 订单编号。
  string order_no = 2;
  // 运单号。
  string tracking_no = 3;
  // 承运商。
  string carrier = 4;
  // 承运商代码。
  string carrier_code = 5;
  // 发货人名。
  string sender_name = 6;
  // 发货人电话。
  string sender_phone = 7;
  // 发货地址。
  string sender_address = 8;
  // 发货纬度。
  double sender_lat = 9;
  // 发货经度。
  double sender_lon = 10;
  // 收货人名。
  string receiver_name = 11;
  // 收货人电话。
  string receiver_phone = 12;
  // 收货地址。
  string receiver_address = 13;
  // 收货纬度。
  double receiver_lat = 14;
  // 收货经度。
  double receiver_lon = 15;
}

// 创建响应。
message CreateLogisticsResponse {
  // 创建后的物流单。
  Logistics logistics = 1;
}

// 查询请求。
message GetLogisticsRequest {
  // 物流单 ID。
  uint64 id = 1;
}

// 查询响应。
message GetLogisticsResponse {
  // 物流单详情。
  Logistics logistics = 1;
}

// 运单号查询请求。
message GetLogisticsByTrackingNoRequest {
  // 物流运单号。
  string tracking_no = 1;
}

// 状态更新请求。
message UpdateStatusRequest {
  // 物流单 ID。
  uint64 id = 1;
  // 新的状态码。
  int32 status = 2;
  // 当前位置描述。
  string location = 3;
  // 处理详情描述。
  string description = 4;
}

// 添加轨迹请求。
message AddTraceRequest {
  // 物流单 ID。
  uint64 id = 1;
  // 轨迹点位置。
  string location = 2;
  // 轨迹描述。
  string description = 3;
  // 轨迹状态。
  string status = 4;
}

// 设置预计时间请求。
message SetEstimatedTimeRequest {
  // 物流单 ID。
  uint64 id = 1;
  // 预计送达时间。
  google.protobuf.Timestamp estimated_time = 2;
}

// 列表查询请求。
message ListLogisticsRequest {
  // 每页数量。
  uint32 page_size = 1;
  // 页码。
  uint32 page_num = 2;
}

// 列表响应。
message ListLogisticsResponse {
  // 物流单列表。
  repeated Logistics logistics = 1;
  // 总记录数。
  uint64 total_count = 2;
}

// 坐标。
message Location {
  // 唯一 ID。
  uint64 id = 1;
  // 纬度。
  double lat = 2;
  // 经度。
  double lon = 3;
}

// 路径优化请求。
message OptimizeDeliveryRouteRequest {
  // 物流单 ID。
  uint64 logistics_id = 1;
  // 待访问的目的地坐标列表。
  repeated Location destinations = 2;
}

// 路径优化响应。
message OptimizeDeliveryRouteResponse {
  // 计算出的最优配送路线。
  DeliveryRoute route = 1;
}
