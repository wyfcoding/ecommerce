syntax = "proto3";

package api.logistics.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/logistics/v1;v1";

// LogisticsService 定义了物流服务接口
service LogisticsService {
  // CreateLogistics 创建物流单
  rpc CreateLogistics(CreateLogisticsRequest) returns (CreateLogisticsResponse);

  // GetLogistics 获取物流信息
  rpc GetLogistics(GetLogisticsRequest) returns (GetLogisticsResponse);

  // GetLogisticsByTrackingNo 根据运单号获取物流信息
  rpc GetLogisticsByTrackingNo(GetLogisticsByTrackingNoRequest) returns (GetLogisticsResponse);

  // UpdateStatus 更新物流状态
  rpc UpdateStatus(UpdateStatusRequest) returns (google.protobuf.Empty);

  // AddTrace 添加物流轨迹
  rpc AddTrace(AddTraceRequest) returns (google.protobuf.Empty);

  // SetEstimatedTime 设置预计送达时间
  rpc SetEstimatedTime(SetEstimatedTimeRequest) returns (google.protobuf.Empty);

  // ListLogistics 获取物流列表
  rpc ListLogistics(ListLogisticsRequest) returns (ListLogisticsResponse);

  // OptimizeDeliveryRoute 优化配送路线
  rpc OptimizeDeliveryRoute(OptimizeDeliveryRouteRequest) returns (OptimizeDeliveryRouteResponse);
}

// Logistics 物流信息
message Logistics {
  uint64 id = 1; // 唯一标识
  uint64 order_id = 2; // 订单唯一标识
  string order_no = 3; // 订单no
  string tracking_no = 4; // 追踪no
  string carrier = 5; // 承运商
  string carrier_code = 6; // carrier代码
  string sender_name = 7; // sender名称
  string sender_phone = 8; // sender电话
  string sender_address = 9; // sender地址
  string receiver_name = 10; // receiver名称
  string receiver_phone = 11; // receiver电话
  string receiver_address = 12; // receiver地址
  double sender_lat = 13; // 发送者纬度
  double sender_lon = 14; // 发送者经度
  double receiver_lat = 15; // 收件人lat
  double receiver_lon = 16; // 收件人lon
  int32 status = 17; // 状态
  string current_location = 18; // 当前位置
  google.protobuf.Timestamp estimated_time = 19; // estimated时间
  google.protobuf.Timestamp delivered_at = 20; // delivered在
  repeated LogisticsTrace traces = 21; // 轨迹
  DeliveryRoute route = 22; // 路由
  google.protobuf.Timestamp created_at = 23; // 创建时间
  google.protobuf.Timestamp updated_at = 24; // 更新时间
}

// LogisticsTrace 物流轨迹
message LogisticsTrace {
  uint64 id = 1; // 唯一标识
  uint64 logistics_id = 2; // 物流id
  string tracking_no = 3; // 追踪no
  string location = 4; // 位置
  string description = 5; // 描述
  string status = 6; // 状态
  google.protobuf.Timestamp created_at = 7; // 创建时间
}

// DeliveryRoute 配送路线
message DeliveryRoute {
  uint64 id = 1; // 唯一标识
  uint64 logistics_id = 2; // 物流id
  string route_data = 3; // route数据
  double distance = 4; // 距离
}

// CreateLogisticsRequest 创建物流请求消息结构。
message CreateLogisticsRequest {
  uint64 order_id = 1; // 订单唯一标识
  string order_no = 2; // 订单no
  string tracking_no = 3; // 追踪no
  string carrier = 4; // 承运商
  string carrier_code = 5; // carrier代码
  string sender_name = 6; // sender名称
  string sender_phone = 7; // sender电话
  string sender_address = 8; // sender地址
  double sender_lat = 9; // 发送者纬度
  double sender_lon = 10; // 发送者经度
  string receiver_name = 11; // receiver名称
  string receiver_phone = 12; // receiver电话
  string receiver_address = 13; // receiver地址
  double receiver_lat = 14; // 收件人lat
  double receiver_lon = 15; // 收件人lon
}

// CreateLogisticsResponse 创建物流响应消息结构。
message CreateLogisticsResponse {
  Logistics logistics = 1; // 物流
}

// GetLogisticsRequest 获取物流请求消息结构。
message GetLogisticsRequest {
  uint64 id = 1; // 唯一标识
}

// GetLogisticsResponse 获取物流响应消息结构。
message GetLogisticsResponse {
  Logistics logistics = 1; // 物流
}

// GetLogisticsByTrackingNoRequest 获取物流被TrackingNo请求消息结构。
message GetLogisticsByTrackingNoRequest {
  string tracking_no = 1; // 追踪no
}

// UpdateStatusRequest 更新状态请求消息结构。
message UpdateStatusRequest {
  uint64 id = 1; // 唯一标识
  int32 status = 2; // 状态
  string location = 3; // 位置
  string description = 4; // 描述
}

// AddTraceRequest AddTrace请求消息结构。
message AddTraceRequest {
  uint64 id = 1; // 唯一标识
  string location = 2; // 位置
  string description = 3; // 描述
  string status = 4; // 状态
}

// SetEstimatedTimeRequest SetEstimated时间请求消息结构。
message SetEstimatedTimeRequest {
  uint64 id = 1; // 唯一标识
  google.protobuf.Timestamp estimated_time = 2; // estimated时间
}

// ListLogisticsRequest 列出物流请求消息结构。
message ListLogisticsRequest {
  uint32 page_size = 1; // 页码大小
  uint32 page_num = 2; // 页码num
}

// ListLogisticsResponse 列出物流响应消息结构。
message ListLogisticsResponse {
  repeated Logistics logistics = 1; // 物流
  uint64 total_count = 2; // 总数计数
}

// Location Location消息结构。
message Location {
  uint64 id = 1; // 唯一标识
  double lat = 2; // 纬度
  double lon = 3; // 经度
}

// OptimizeDeliveryRouteRequest OptimizeDeliveryRoute请求消息结构。
message OptimizeDeliveryRouteRequest {
  uint64 logistics_id = 1; // 物流id
  repeated Location destinations = 2; // 目的地列表
}

// OptimizeDeliveryRouteResponse OptimizeDeliveryRoute响应消息结构。
message OptimizeDeliveryRouteResponse {
  DeliveryRoute route = 1; // 路由
}
