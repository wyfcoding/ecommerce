syntax = "proto3";

package api.payment.v1;

import "google/api/annotations.proto";
<<<<<<< HEAD
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

option go_package = "ecommerce/api/payment/v1;v1";

// PaymentService 定义了支付相关的 gRPC 服务
service PaymentService {
  // 创建支付请求
  rpc CreatePayment(CreatePaymentRequest) returns (PaymentResponse) {
    option (google.api.http) = {
      post: "/v1/payment/create"
=======

option go_package = "ecommerce/api/payment/v1;v1";

// PaymentService 定义了支付服务接口
service PaymentService {
  // 发起支付
  rpc CreatePayment(CreatePaymentRequest) returns (CreatePaymentResponse) {
    option (google.api.http) = {
      post: "/v1/payments"
>>>>>>> 04d1270d593e17e866ec0ca4dad1f5d56021f07d
      body: "*"
    };
  }

<<<<<<< HEAD
  // 获取支付状态
  rpc GetPaymentStatus(GetPaymentStatusRequest) returns (PaymentResponse) {
    option (google.api.http) = {
      get: "/v1/payment/{payment_id}/status"
    };
  }

  // TODO: Add more RPCs for payment callbacks, refunds, etc.
}

// PaymentStatus 定义支付状态
enum PaymentStatus {
  PAYMENT_STATUS_UNKNOWN = 0;
  PAYMENT_STATUS_PENDING = 1; // 待支付
  PAYMENT_STATUS_SUCCESS = 2; // 支付成功
  PAYMENT_STATUS_FAILED = 3;  // 支付失败
  PAYMENT_STATUS_REFUNDED = 4; // 已退款
  PAYMENT_STATUS_CLOSED = 5;  // 交易关闭
}

// PaymentMethod 定义支付方式
enum PaymentMethod {
  PAYMENT_METHOD_UNKNOWN = 0;
  PAYMENT_METHOD_WECHAT = 1;
  PAYMENT_METHOD_ALIPAY = 2;
  PAYMENT_METHOD_BANK_TRANSFER = 3;
  PAYMENT_METHOD_CREDIT_CARD = 4;
}

// Payment 结构体定义支付信息
message Payment {
  string payment_id = 1; // 支付ID，通常由支付系统生成
  string order_id = 2;   // 关联的订单ID
  uint64 user_id = 3;    // 用户ID
  double amount = 4;     // 支付金额
  PaymentMethod method = 5; // 支付方式
  PaymentStatus status = 6; // 支付状态
  string transaction_id = 7; // 第三方支付交易ID
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
  optional string currency = 10; // 货币类型，例如 CNY, USD
}

// CreatePaymentRequest 创建支付请求
message CreatePaymentRequest {
  string order_id = 1;
  uint64 user_id = 2;
  double amount = 3;
  PaymentMethod method = 4;
  optional string currency = 5;
}

// GetPaymentStatusRequest 获取支付状态请求
message GetPaymentStatusRequest {
  string payment_id = 1;
}

// PaymentResponse 支付响应
message PaymentResponse {
  Payment payment = 1;
}
=======
  // 处理支付回调 (由支付网关调用)
  rpc HandlePaymentCallback(HandlePaymentCallbackRequest) returns (HandlePaymentCallbackResponse) {
    option (google.api.http) = {
      post: "/v1/payments/callback"
      body: "*"
    };
  }
}

// CreatePaymentRequest 发起支付请求
message CreatePaymentRequest {
  uint64 order_id = 1;
  uint64 user_id = 2;
  uint64 amount = 3; // 支付金额 (分)
  string currency = 4; // 货币单位，如 CNY
  string payment_method = 5; // 支付方式，如 "WECHAT_PAY", "ALIPAY"
  string return_url = 6; // 支付成功后跳转的URL
}

// CreatePaymentResponse 发起支付响应
message CreatePaymentResponse {
  string payment_id = 1; // 支付系统生成的唯一ID
  string redirect_url = 2; // 跳转到支付网关的URL (如果需要)
  string qr_code_url = 3; // 扫码支付二维码URL (如果需要)
  string status = 4; // 支付状态，如 "PENDING", "SUCCESS", "FAIL"
}

// HandlePaymentCallbackRequest 处理支付回调请求
message HandlePaymentCallbackRequest {
  string payment_method = 1; // 支付方式
  map<string, string> callback_data = 2; // 支付网关回调的原始数据
}

// HandlePaymentCallbackResponse 处理支付回调响应
message HandlePaymentCallbackResponse {
  string status = 1; // 处理结果，如 "SUCCESS", "FAIL"
  string message = 2; // 消息
}
>>>>>>> 04d1270d593e17e866ec0ca4dad1f5d56021f07d
