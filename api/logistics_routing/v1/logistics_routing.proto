syntax = "proto3";

package api.logistics_routing.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/logistics_routing/v1;v1";

// 物流路由服务，负责配送商管理及多订单智能分拨优化。
service LogisticsRoutingService {
  // 录入合作的配送商/承运商信息。
  rpc RegisterCarrier(RegisterCarrierRequest) returns (google.protobuf.Empty);

  // 针对一批订单进行全局最优配送路径及承运商分配。
  rpc OptimizeRoute(OptimizeRouteRequest) returns (OptimizeRouteResponse);

  // 获取已计算好的路由结果详情。
  rpc GetRoute(GetRouteRequest) returns (GetRouteResponse);

  // 查询当前支持的所有承运商列表。
  rpc ListCarriers(google.protobuf.Empty) returns (ListCarriersResponse);
}

// 承运商/配送商实体。
message Carrier {
  // 唯一 ID。
  uint64 id = 1;
  // 承运商名称（如 "顺丰"）。
  string name = 2;
  // 类型标识。
  string type = 3;
  // 首重或基础运费。
  int64 base_cost = 4;
  // 续重费率。
  double weight_rate = 5;
  // 距离费率。
  double distance_rate = 6;
  // 基础配送时长（小时）。
  int32 base_delivery_time = 7;
  // 支持的地区/国家。
  repeated string supported_regions = 8;
  // 剩余运力/包裹承载量。
  int32 available_capacity = 9;
  // 质量评分 (0-5.0)。
  double rating = 10;
  // 是否激活。
  bool is_active = 11;
  // 记录创建时间。
  google.protobuf.Timestamp created_at = 12;
  // 修改时间。
  google.protobuf.Timestamp updated_at = 13;
}

// 单笔订单路由结果。
message RouteOrder {
  // 订单 ID。
  uint64 order_id = 1;
  // 分配的承运商 ID。
  uint64 carrier_id = 2;
  // 承运商名称。
  string carrier_name = 3;
  // 预估运费成本。
  int64 estimated_cost = 4;
  // 预估耗时（小时）。
  int32 estimated_time = 5;
}

// 整体路由优化结果集。
message OptimizedRoute {
  // 结果 ID。
  uint64 id = 1;
  // 订单路由映射列表。
  repeated RouteOrder orders = 2;
  // 处理订单总数。
  int32 order_count = 3;
  // 总成本。
  int64 total_cost = 4;
  // 平均单笔成本。
  int64 average_cost = 5;
  // 生成时间。
  google.protobuf.Timestamp created_at = 6;
  // 修改时间。
  google.protobuf.Timestamp updated_at = 7;
}

// 承运商注册请求。
message RegisterCarrierRequest {
  // 姓名。
  string name = 1;
  // 类别。
  string type = 2;
  // 基础成本。
  int64 base_cost = 3;
  // 重量费率。
  double weight_rate = 4;
  // 距离费率。
  double distance_rate = 5;
  // 预计耗时。
  int32 base_delivery_time = 6;
  // 支持区域。
  repeated string supported_regions = 7;
  // 当前运力。
  int32 available_capacity = 8;
}

// 优化请求。
message OptimizeRouteRequest {
  // 待分拨的订单 ID 列表。
  repeated uint64 order_ids = 1;
}

// 优化响应。
message OptimizeRouteResponse {
  // 计算结果。
  OptimizedRoute route = 1;
}

// 详情查询。
message GetRouteRequest {
  // 结果 ID。
  uint64 id = 1;
}

// 详情响应。
message GetRouteResponse {
  // 路由数据。
  OptimizedRoute route = 1;
}

// 承运商列表。
message ListCarriersResponse {
  // 承运商集合。
  repeated Carrier carriers = 1;
}
