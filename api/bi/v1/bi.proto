syntax = "proto3";

package api.bi.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/bi/v1;v1";

// 商业智能服务，提供销售数据统计及用户留存分析报告。
service BI {
  // 获取指定维度的历史销售统计数据。
  rpc GetSalesData(GetSalesDataRequest) returns (GetSalesDataResponse);

  // 获取多周期内的用户留存分析指标。
  rpc GetUserRetention(GetUserRetentionRequest) returns (GetUserRetentionResponse);
}

// 销售数据请求。
message GetSalesDataRequest {
  // 查询起始日期。
  google.protobuf.Timestamp start_date = 1;
  // 查询结束日期。
  google.protobuf.Timestamp end_date = 2;
  // 可选的产品分类过滤。
  optional string product_category = 3;
}

// 销售数据时间点。
message SalesDataPoint {
  // 统计日期。
  google.protobuf.Timestamp date = 1;
  // 累计销售总额。
  double total_sales = 2;
  // 累计订单笔数。
  uint64 order_count = 3;
}

// 销售数据响应。
message GetSalesDataResponse {
  // 按时间序列排列的数据点。
  repeated SalesDataPoint data_points = 1;
}

// 留存分析请求。
message GetUserRetentionRequest {
  // 开始分析日期。
  google.protobuf.Timestamp start_date = 1;
  // 结束分析日期。
  google.protobuf.Timestamp end_date = 2;
  // 同期群的时间跨度（天）。
  int32 cohort_size_days = 3;
}

// 留存率数据点。
message UserRetentionDataPoint {
  // 初始访问日期。
  google.protobuf.Timestamp cohort_date = 1;
  // 各周期的留存率序列（如 [1.0, 0.5, 0.3]）。
  repeated double retention_rates = 2;
}

// 留存分析响应。
message GetUserRetentionResponse {
  // 画像分析结果序列。
  repeated UserRetentionDataPoint data_points = 1;
}
