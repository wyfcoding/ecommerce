syntax = "proto3";

package api.fraud_detection.v1;

import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/goapi/fraud_detection/v1;v1";

// 欺诈检测服务，负责核心交易流程的实时风险评分、异步评估及手动黑名单标记。
service FraudDetection {
  // 实时同步接口：对当前交易进行多维度合规性及欺诈风险判定。
  rpc EvaluateTransaction(EvaluateTransactionRequest) returns (EvaluateTransactionResponse);

  // 通过流水 ID 查询既往评估的历史判定结果。
  rpc GetEvaluationStatus(GetEvaluationStatusRequest) returns (GetEvaluationStatusResponse);

  // 允许业务系统或管理员录入确认的欺诈案例，用于增强拦截规则。
  rpc ReportFraud(ReportFraudRequest) returns (ReportFraudResponse);
}

// 风险评估报告。
message FraudEvaluation {
  // 原始流水号。
  string transaction_id = 1;
  // 发起人。
  string user_id = 2;
  // 判定建议 (APPROVED, REVIEW, BLOCKED)。
  string status = 3;
  // 归一化风险得分 (0-100)。
  double score = 4;
  // 触发的风险特征项列表。
  repeated string reasons = 5;
  // 判定完成时刻。
  google.protobuf.Timestamp evaluated_at = 6;
}

// 风险评估请求。
message EvaluateTransactionRequest {
  // 交易 ID。
  string transaction_id = 1;
  // 行为人 ID。
  string user_id = 2;
  // 金额数值。
  double amount = 3;
  // 币种。
  string currency = 4;
  // 支付介质类型。
  string payment_method_type = 5;
  // 网络 IP 地址。
  string ip_address = 6;
  // 浏览器或设备环境信息。
  string user_agent = 7;
  // 其他用于计算的动态特征载荷。
  map<string, string> additional_data = 8;
}

// 评估回执。
message EvaluateTransactionResponse {
  // 分析结果对象。
  FraudEvaluation evaluation = 1;
}

// ID 查询。
message GetEvaluationStatusRequest {
  // 流水号。
  string transaction_id = 1;
}

// ID 查询结果。
message GetEvaluationStatusResponse {
  // 分析报告。
  FraudEvaluation evaluation = 1;
}

// 欺诈上报。
message ReportFraudRequest {
  // 确认欺诈的 ID。
  string transaction_id = 1;
  // 归责用户。
  string user_id = 2;
  // 情况说明。
  string report_reason = 3;
  // 核心证据映射。
  map<string, string> evidence = 4;
}

// 上报结果。
message ReportFraudResponse {
  // 处理回执状态。
  bool success = 1;
  // 操作提示语。
  string message = 2;
}
