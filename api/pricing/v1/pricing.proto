syntax = "proto3";

package api.pricing.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/wyfcoding/ecommerce/go-api/pricing/v1;pricingv1";

// 动态定价服务，负责管理价格规则及计算商品的最终实时售价。
service PricingService {
  // 创建定价规则。
  rpc CreateRule(CreateRuleRequest) returns (CreateRuleResponse);

  // 分页列出定价规则。
  rpc ListRules(ListRulesRequest) returns (ListRulesResponse);

  // 根据当前市场需求、竞争情况等因素计算实时价格。
  rpc CalculatePrice(CalculatePriceRequest) returns (CalculatePriceResponse);

  // 记录一次价格变动历史。
  rpc RecordHistory(RecordHistoryRequest) returns (google.protobuf.Empty);

  // 查询商品的价格变动记录。
  rpc ListHistory(ListHistoryRequest) returns (ListHistoryResponse);
}

// 定价规则。
message PricingRule {
  // 唯一 ID。
  uint64 id = 1;
  // 规则名称。
  string name = 2;
  // 关联商品 ID。
  uint64 product_id = 3;
  // 关联 SKU ID。
  uint64 sku_id = 4;
  // 定价策略（如 COST_PLUS, COMPETITIVE, DYNAMIC）。
  string strategy = 5;
  // 成本价或基准价。
  uint64 base_price = 6;
  // 允许的最低价限制。
  uint64 min_price = 7;
  // 允许的最高价限制。
  uint64 max_price = 8;
  // 价格调整幅度（如 0.1 代表加价 10%）。
  double adjust_rate = 9;
  // 是否启用规则。
  bool enabled = 10;
  // 规则生效时间。
  google.protobuf.Timestamp start_time = 11;
  // 规则失效时间。
  google.protobuf.Timestamp end_time = 12;
  // 创建时间。
  google.protobuf.Timestamp created_at = 13;
  // 最后更新时间。
  google.protobuf.Timestamp updated_at = 14;
}

// 价格历史记录。
message PriceHistory {
  // 记录 ID。
  uint64 id = 1;
  // 商品 ID。
  uint64 product_id = 2;
  // SKU ID。
  uint64 sku_id = 3;
  // 调整后的新价格。
  uint64 price = 4;
  // 调整前的旧价格。
  uint64 old_price = 5;
  // 价格变动比例。
  double change_rate = 6;
  // 变动原因描述。
  string reason = 7;
  // 创建时间。
  google.protobuf.Timestamp created_at = 8;
  // 更新时间。
  google.protobuf.Timestamp updated_at = 9;
}

// 规则创建请求。
message CreateRuleRequest {
  // 名称。
  string name = 1;
  // 商品 ID。
  uint64 product_id = 2;
  // SKU ID。
  uint64 sku_id = 3;
  // 策略名。
  string strategy = 4;
  // 基准价。
  uint64 base_price = 5;
  // 最低限价。
  uint64 min_price = 6;
  // 最高限价。
  uint64 max_price = 7;
  // 调整率。
  double adjust_rate = 8;
  // 是否立即启用。
  bool enabled = 9;
  // 开始生效日期。
  google.protobuf.Timestamp start_time = 10;
  // 结束生效日期。
  google.protobuf.Timestamp end_time = 11;
}

// 规则创建响应。
message CreateRuleResponse {
  // 创建成功的规则详情。
  PricingRule rule = 1;
}

// 规则查询请求。
message ListRulesRequest {
  // 针对特定商品筛选。
  uint64 product_id = 1;
  // 页码。
  int32 page = 2;
  // 每页数量。
  int32 page_size = 3;
}

// 规则查询响应。
message ListRulesResponse {
  // 规则列表数据。
  repeated PricingRule rules = 1;
  // 总记录数。
  int64 total_count = 2;
}

// 价格计算请求。
message CalculatePriceRequest {
  // 商品 ID。
  uint64 product_id = 1;
  // SKU ID。
  uint64 sku_id = 2;
  // 实时需求因子 (0.0 - 1.0)。
  double demand = 3;
  // 竞争激烈程度。
  double competition = 4;
}

// 价格计算响应。
message CalculatePriceResponse {
  // 计算出的建议零售价。
  uint64 price = 1;
}

// 历史记录保存请求。
message RecordHistoryRequest {
  // 商品 ID。
  uint64 product_id = 1;
  // SKU ID。
  uint64 sku_id = 2;
  // 新价格。
  uint64 price = 3;
  // 旧价格。
  uint64 old_price = 4;
  // 变动理由。
  string reason = 5;
}

// 历史记录查询请求。
message ListHistoryRequest {
  // 商品 ID。
  uint64 product_id = 1;
  // SKU ID。
  uint64 sku_id = 2;
  // 页码。
  int32 page = 3;
  // 每页数量。
  int32 page_size = 4;
}

// 历史记录查询响应。
message ListHistoryResponse {
  // 变动记录序列。
  repeated PriceHistory history = 1;
  // 总记录数。
  int64 total_count = 2;
}
