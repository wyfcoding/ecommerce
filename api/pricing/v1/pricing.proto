syntax = "proto3";

package api.pricing.v1;

import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

option go_package = "github.com/wyfcoding/ecommerce/api/pricing/v1;pricingv1";

service PricingService {
  // Rule Management
  rpc CreateRule(CreateRuleRequest) returns (CreateRuleResponse);
  rpc ListRules(ListRulesRequest) returns (ListRulesResponse);

  // Price Calculation
  rpc CalculatePrice(CalculatePriceRequest) returns (CalculatePriceResponse);

  // History Management
  rpc RecordHistory(RecordHistoryRequest) returns (google.protobuf.Empty);
  rpc ListHistory(ListHistoryRequest) returns (ListHistoryResponse);
}

message PricingRule {
  uint64 id = 1;
  string name = 2;
  uint64 product_id = 3;
  uint64 sku_id = 4;
  string strategy = 5;
  uint64 base_price = 6;
  uint64 min_price = 7;
  uint64 max_price = 8;
  double adjust_rate = 9;
  bool enabled = 10;
  google.protobuf.Timestamp start_time = 11;
  google.protobuf.Timestamp end_time = 12;
  google.protobuf.Timestamp created_at = 13;
  google.protobuf.Timestamp updated_at = 14;
}

message PriceHistory {
  uint64 id = 1;
  uint64 product_id = 2;
  uint64 sku_id = 3;
  uint64 price = 4;
  uint64 old_price = 5;
  double change_rate = 6;
  string reason = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message CreateRuleRequest {
  string name = 1;
  uint64 product_id = 2;
  uint64 sku_id = 3;
  string strategy = 4;
  uint64 base_price = 5;
  uint64 min_price = 6;
  uint64 max_price = 7;
  double adjust_rate = 8;
  bool enabled = 9;
  google.protobuf.Timestamp start_time = 10;
  google.protobuf.Timestamp end_time = 11;
}

message CreateRuleResponse {
  PricingRule rule = 1;
}

message ListRulesRequest {
  uint64 product_id = 1;
  int32 page = 2;
  int32 page_size = 3;
}

message ListRulesResponse {
  repeated PricingRule rules = 1;
  int64 total_count = 2;
}

message CalculatePriceRequest {
  uint64 product_id = 1;
  uint64 sku_id = 2;
  double demand = 3;
  double competition = 4;
}

message CalculatePriceResponse {
  uint64 price = 1;
}

message RecordHistoryRequest {
  uint64 product_id = 1;
  uint64 sku_id = 2;
  uint64 price = 3;
  uint64 old_price = 4;
  string reason = 5;
}

message ListHistoryRequest {
  uint64 product_id = 1;
  uint64 sku_id = 2;
  int32 page = 3;
  int32 page_size = 4;
}

message ListHistoryResponse {
  repeated PriceHistory history = 1;
  int64 total_count = 2;
}
