apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "chart.fullname" . }}-config # ConfigMap 的名称，通常与 Chart 的全名加上 -config 后缀
  labels:
    {{- include "chart.labels" . | nindent 4 }} # 继承 Chart 的标签
data:
  # aftersales.toml 文件内容，用于存储微服务的配置信息。
  # 注意：ConfigMap 不应存储敏感数据，敏感信息应通过 Kubernetes Secrets 管理。
  aftersales.toml: |
    # 服务基础配置
    [server.http]
    addr = "0.0.0.0" # HTTP 服务监听地址
    port = 8080      # HTTP 服务监听端口
    timeout = "1s"   # HTTP 请求超时时间

    [server.grpc]
    addr = "0.0.0.0" # gRPC 服务监听地址
    port = 9090      # gRPC 服务监听端口
    timeout = "1s"   # gRPC 请求超时时间

    # 数据库配置
    [data.database]
    driver = "mysql" # 数据库驱动类型
    # DSN (Data Source Name) 数据库连接字符串。
    # 警告：生产环境中的数据库密码（your_password）绝不能直接硬编码在 ConfigMap 中。
    # 强烈建议使用 Kubernetes Secrets 来安全地管理数据库凭据，并通过环境变量或卷挂载注入到 Pod 中。
    dsn = "root:your_password@tcp(127.0.0.1:3306)/ecommerce_aftersales?charset=utf8mb4&parseTime=True&loc=Local"

    # JWT (JSON Web Token) 配置
    [jwt]
    # secret 是用于签名和验证 JWT 的密钥。
    # 警告：生产环境中的 JWT 密钥（your-secret-key）绝不能直接硬编码在 ConfigMap 中。
    # 强烈建议使用 Kubernetes Secrets 来安全地管理此密钥。
    secret = "your-secret-key" 
    issuer = "ecommerce-aftersales-service" # JWT 签发者
    expire_duration = "24h"            # JWT 有效期

    # 链路追踪配置 (Tracing)
    [tracing]
    jaeger_endpoint = "http://localhost:14268/api/traces" # Jaeger 收集器地址

    # 日志配置 (Logging)
    [log]
    level = "debug" # 日志级别：debug, info, warn, error, fatal, panic
    format = "json" # 日志输出格式：text 或 json。在生产环境中，json 格式更便于日志分析系统处理。
    output = "stdout" # 日志输出目标：stdout (标准输出), stderr (标准错误) 或 文件路径。建议输出到 stdout/stderr，由容器运行时和日志收集系统处理。